//
//  Copyright (c) 2013 Sam Leitch. All rights reserved.
//
//  Permission is hereby granted, free of charge, to any person obtaining a copy
//  of this software and associated documentation files (the "Software"), to
//  deal in the Software without restriction, including without limitation the
//  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
//  sell copies of the Software, and to permit persons to whom the Software is
//  furnished to do so, subject to the following conditions:
//
//  The above copyright notice and this permission notice shall be included in
//  all copies or substantial portions of the Software.
//
//  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
//  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
//  IN THE SOFTWARE.
//
export class H264Decoder {
    constructor(libavH264Module, onPictureReady) {
        this.libavH264Module = libavH264Module;
        this.onPictureReady = onPictureReady;
        this.codecContext = this.libavH264Module._create_codec_context();
        this.dataIn = this.libavH264Module._malloc(1024 * 1024);
        this.yPlaneOut = this.libavH264Module._malloc(4);
        this.uPlaneOut = this.libavH264Module._malloc(4);
        this.vPlaneOut = this.libavH264Module._malloc(4);
        this.widthOut = this.libavH264Module._malloc(4);
        this.heightOut = this.libavH264Module._malloc(4);
        this.strideOut = this.libavH264Module._malloc(4);
    }
    release() {
        this.libavH264Module._destroy_codec_context(this.codecContext);
        this.libavH264Module._free(this.dataIn);
        this.libavH264Module._free(this.yPlaneOut);
        this.libavH264Module._free(this.widthOut);
        this.libavH264Module._free(this.heightOut);
    }
    decode(nal) {
        this.libavH264Module.HEAPU8.set(nal, this.dataIn);
        const ptr = this.libavH264Module._decode(this.codecContext, this.dataIn, nal.byteLength, this.yPlaneOut, this.uPlaneOut, this.vPlaneOut, this.widthOut, this.heightOut, this.strideOut);
        const yPlanePtr = this.libavH264Module.getValue(this.yPlaneOut, 'i8*');
        const uPlanePtr = this.libavH264Module.getValue(this.uPlaneOut, 'i8*');
        const vPlanePtr = this.libavH264Module.getValue(this.vPlaneOut, 'i8*');
        const width = this.libavH264Module.getValue(this.widthOut, 'i32');
        const height = this.libavH264Module.getValue(this.heightOut, 'i32');
        const stride = this.libavH264Module.getValue(this.strideOut, 'i32');
        // We assume I420 output else this will fail miserably
        // TODO we should probably handle other formats as well
        const lumaSize = height * stride;
        const chromaSize = (height * stride) / 2;
        if (yPlanePtr === 0) {
            return;
        }
        const yPlane = new Uint8Array(this.libavH264Module.HEAPU8.subarray(yPlanePtr, yPlanePtr + lumaSize));
        const uPlane = new Uint8Array(this.libavH264Module.HEAPU8.subarray(uPlanePtr, uPlanePtr + chromaSize));
        const vPlane = new Uint8Array(this.libavH264Module.HEAPU8.subarray(vPlanePtr, vPlanePtr + chromaSize));
        this.onPictureReady({
            ptr,
            yPlane,
            uPlane,
            vPlane,
            stride,
        }, width, height);
    }
    closeFrame(framePtr) {
        this.libavH264Module._close_frame(framePtr);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSDI2NERlY29kZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvSDI2NERlY29kZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsRUFBRTtBQUNGLHVEQUF1RDtBQUN2RCxFQUFFO0FBQ0YsZ0ZBQWdGO0FBQ2hGLDRFQUE0RTtBQUM1RSw4RUFBOEU7QUFDOUUsK0VBQStFO0FBQy9FLDhFQUE4RTtBQUM5RSw0REFBNEQ7QUFDNUQsRUFBRTtBQUNGLDhFQUE4RTtBQUM5RSx1REFBdUQ7QUFDdkQsRUFBRTtBQUNGLDhFQUE4RTtBQUM5RSw0RUFBNEU7QUFDNUUsK0VBQStFO0FBQy9FLDBFQUEwRTtBQUMxRSwyRUFBMkU7QUFDM0UsZ0ZBQWdGO0FBQ2hGLG9CQUFvQjtBQUNwQixFQUFFO0FBS0YsTUFBTSxPQUFPLFdBQVc7SUFjdEIsWUFDbUIsZUFBMEIsRUFDMUIsY0FBZ0Y7UUFEaEYsb0JBQWUsR0FBZixlQUFlLENBQVc7UUFDMUIsbUJBQWMsR0FBZCxjQUFjLENBQWtFO1FBRWpHLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFBO1FBQ2hFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBRXZELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDaEQsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNoRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBRWhELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDL0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNoRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2xELENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLGVBQWUsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7UUFDOUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3ZDLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUUxQyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDekMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQzVDLENBQUM7SUFFRCxNQUFNLENBQUMsR0FBZTtRQUNwQixJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNqRCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FDdEMsSUFBSSxDQUFDLFlBQVksRUFDakIsSUFBSSxDQUFDLE1BQU0sRUFDWCxHQUFHLENBQUMsVUFBVSxFQUVkLElBQUksQ0FBQyxTQUFTLEVBQ2QsSUFBSSxDQUFDLFNBQVMsRUFDZCxJQUFJLENBQUMsU0FBUyxFQUVkLElBQUksQ0FBQyxRQUFRLEVBQ2IsSUFBSSxDQUFDLFNBQVMsRUFDZCxJQUFJLENBQUMsU0FBUyxDQUNmLENBQUE7UUFFRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3RFLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDdEUsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUV0RSxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ2pFLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDbkUsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUVuRSxzREFBc0Q7UUFDdEQsdURBQXVEO1FBQ3ZELE1BQU0sUUFBUSxHQUFHLE1BQU0sR0FBRyxNQUFNLENBQUE7UUFDaEMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBRXhDLElBQUksU0FBUyxLQUFLLENBQUMsRUFBRTtZQUNuQixPQUFNO1NBQ1A7UUFFRCxNQUFNLE1BQU0sR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLFNBQVMsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFBO1FBQ3BHLE1BQU0sTUFBTSxHQUFHLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsU0FBUyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUE7UUFDdEcsTUFBTSxNQUFNLEdBQUcsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxTQUFTLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQTtRQUV0RyxJQUFJLENBQUMsY0FBYyxDQUNqQjtZQUNFLEdBQUc7WUFDSCxNQUFNO1lBQ04sTUFBTTtZQUNOLE1BQU07WUFDTixNQUFNO1NBQ1AsRUFDRCxLQUFLLEVBQ0wsTUFBTSxDQUNQLENBQUE7SUFDSCxDQUFDO0lBRUQsVUFBVSxDQUFDLFFBQWdCO1FBQ3pCLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQzdDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8vXG4vLyAgQ29weXJpZ2h0IChjKSAyMDEzIFNhbSBMZWl0Y2guIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vL1xuLy8gIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vICBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0b1xuLy8gIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlXG4vLyAgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yXG4vLyAgc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vICBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vICBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vICBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyAgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyAgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyAgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HXG4vLyAgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HU1xuLy8gIElOIFRIRSBTT0ZUV0FSRS5cbi8vXG5cbmltcG9ydCB7IGxpYmF2aDI2NCB9IGZyb20gJy4vSDI2NFdvcmtlcidcbmltcG9ydCB7IEZmbXBlZ0gyNjRGcmFtZSB9IGZyb20gJy4vaW5kZXgnXG5cbmV4cG9ydCBjbGFzcyBIMjY0RGVjb2RlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29kZWNDb250ZXh0OiBudW1iZXJcbiAgcHJpdmF0ZSByZWFkb25seSBkYXRhSW46IG51bWJlclxuXG4gIHByaXZhdGUgcmVhZG9ubHkgeVBsYW5lT3V0OiBudW1iZXJcbiAgcHJpdmF0ZSByZWFkb25seSBzdHJpZGVPdXQ6IG51bWJlclxuXG4gIHByaXZhdGUgcmVhZG9ubHkgdVBsYW5lT3V0OiBudW1iZXJcblxuICBwcml2YXRlIHJlYWRvbmx5IHZQbGFuZU91dDogbnVtYmVyXG5cbiAgcHJpdmF0ZSByZWFkb25seSB3aWR0aE91dDogbnVtYmVyXG4gIHByaXZhdGUgcmVhZG9ubHkgaGVpZ2h0T3V0OiBudW1iZXJcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGxpYmF2SDI2NE1vZHVsZTogbGliYXZoMjY0LFxuICAgIHByaXZhdGUgcmVhZG9ubHkgb25QaWN0dXJlUmVhZHk6IChvdXRwdXQ6IEZmbXBlZ0gyNjRGcmFtZSwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpID0+IHZvaWQsXG4gICkge1xuICAgIHRoaXMuY29kZWNDb250ZXh0ID0gdGhpcy5saWJhdkgyNjRNb2R1bGUuX2NyZWF0ZV9jb2RlY19jb250ZXh0KClcbiAgICB0aGlzLmRhdGFJbiA9IHRoaXMubGliYXZIMjY0TW9kdWxlLl9tYWxsb2MoMTAyNCAqIDEwMjQpXG5cbiAgICB0aGlzLnlQbGFuZU91dCA9IHRoaXMubGliYXZIMjY0TW9kdWxlLl9tYWxsb2MoNClcbiAgICB0aGlzLnVQbGFuZU91dCA9IHRoaXMubGliYXZIMjY0TW9kdWxlLl9tYWxsb2MoNClcbiAgICB0aGlzLnZQbGFuZU91dCA9IHRoaXMubGliYXZIMjY0TW9kdWxlLl9tYWxsb2MoNClcblxuICAgIHRoaXMud2lkdGhPdXQgPSB0aGlzLmxpYmF2SDI2NE1vZHVsZS5fbWFsbG9jKDQpXG4gICAgdGhpcy5oZWlnaHRPdXQgPSB0aGlzLmxpYmF2SDI2NE1vZHVsZS5fbWFsbG9jKDQpXG4gICAgdGhpcy5zdHJpZGVPdXQgPSB0aGlzLmxpYmF2SDI2NE1vZHVsZS5fbWFsbG9jKDQpXG4gIH1cblxuICByZWxlYXNlKCkge1xuICAgIHRoaXMubGliYXZIMjY0TW9kdWxlLl9kZXN0cm95X2NvZGVjX2NvbnRleHQodGhpcy5jb2RlY0NvbnRleHQpXG4gICAgdGhpcy5saWJhdkgyNjRNb2R1bGUuX2ZyZWUodGhpcy5kYXRhSW4pXG4gICAgdGhpcy5saWJhdkgyNjRNb2R1bGUuX2ZyZWUodGhpcy55UGxhbmVPdXQpXG5cbiAgICB0aGlzLmxpYmF2SDI2NE1vZHVsZS5fZnJlZSh0aGlzLndpZHRoT3V0KVxuICAgIHRoaXMubGliYXZIMjY0TW9kdWxlLl9mcmVlKHRoaXMuaGVpZ2h0T3V0KVxuICB9XG5cbiAgZGVjb2RlKG5hbDogVWludDhBcnJheSkge1xuICAgIHRoaXMubGliYXZIMjY0TW9kdWxlLkhFQVBVOC5zZXQobmFsLCB0aGlzLmRhdGFJbilcbiAgICBjb25zdCBwdHIgPSB0aGlzLmxpYmF2SDI2NE1vZHVsZS5fZGVjb2RlKFxuICAgICAgdGhpcy5jb2RlY0NvbnRleHQsXG4gICAgICB0aGlzLmRhdGFJbixcbiAgICAgIG5hbC5ieXRlTGVuZ3RoLFxuXG4gICAgICB0aGlzLnlQbGFuZU91dCxcbiAgICAgIHRoaXMudVBsYW5lT3V0LFxuICAgICAgdGhpcy52UGxhbmVPdXQsXG5cbiAgICAgIHRoaXMud2lkdGhPdXQsXG4gICAgICB0aGlzLmhlaWdodE91dCxcbiAgICAgIHRoaXMuc3RyaWRlT3V0LFxuICAgIClcblxuICAgIGNvbnN0IHlQbGFuZVB0ciA9IHRoaXMubGliYXZIMjY0TW9kdWxlLmdldFZhbHVlKHRoaXMueVBsYW5lT3V0LCAnaTgqJylcbiAgICBjb25zdCB1UGxhbmVQdHIgPSB0aGlzLmxpYmF2SDI2NE1vZHVsZS5nZXRWYWx1ZSh0aGlzLnVQbGFuZU91dCwgJ2k4KicpXG4gICAgY29uc3QgdlBsYW5lUHRyID0gdGhpcy5saWJhdkgyNjRNb2R1bGUuZ2V0VmFsdWUodGhpcy52UGxhbmVPdXQsICdpOConKVxuXG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLmxpYmF2SDI2NE1vZHVsZS5nZXRWYWx1ZSh0aGlzLndpZHRoT3V0LCAnaTMyJylcbiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmxpYmF2SDI2NE1vZHVsZS5nZXRWYWx1ZSh0aGlzLmhlaWdodE91dCwgJ2kzMicpXG4gICAgY29uc3Qgc3RyaWRlID0gdGhpcy5saWJhdkgyNjRNb2R1bGUuZ2V0VmFsdWUodGhpcy5zdHJpZGVPdXQsICdpMzInKVxuXG4gICAgLy8gV2UgYXNzdW1lIEk0MjAgb3V0cHV0IGVsc2UgdGhpcyB3aWxsIGZhaWwgbWlzZXJhYmx5XG4gICAgLy8gVE9ETyB3ZSBzaG91bGQgcHJvYmFibHkgaGFuZGxlIG90aGVyIGZvcm1hdHMgYXMgd2VsbFxuICAgIGNvbnN0IGx1bWFTaXplID0gaGVpZ2h0ICogc3RyaWRlXG4gICAgY29uc3QgY2hyb21hU2l6ZSA9IChoZWlnaHQgKiBzdHJpZGUpIC8gMlxuXG4gICAgaWYgKHlQbGFuZVB0ciA9PT0gMCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgeVBsYW5lID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5saWJhdkgyNjRNb2R1bGUuSEVBUFU4LnN1YmFycmF5KHlQbGFuZVB0ciwgeVBsYW5lUHRyICsgbHVtYVNpemUpKVxuICAgIGNvbnN0IHVQbGFuZSA9IG5ldyBVaW50OEFycmF5KHRoaXMubGliYXZIMjY0TW9kdWxlLkhFQVBVOC5zdWJhcnJheSh1UGxhbmVQdHIsIHVQbGFuZVB0ciArIGNocm9tYVNpemUpKVxuICAgIGNvbnN0IHZQbGFuZSA9IG5ldyBVaW50OEFycmF5KHRoaXMubGliYXZIMjY0TW9kdWxlLkhFQVBVOC5zdWJhcnJheSh2UGxhbmVQdHIsIHZQbGFuZVB0ciArIGNocm9tYVNpemUpKVxuXG4gICAgdGhpcy5vblBpY3R1cmVSZWFkeShcbiAgICAgIHtcbiAgICAgICAgcHRyLFxuICAgICAgICB5UGxhbmUsXG4gICAgICAgIHVQbGFuZSxcbiAgICAgICAgdlBsYW5lLFxuICAgICAgICBzdHJpZGUsXG4gICAgICB9LFxuICAgICAgd2lkdGgsXG4gICAgICBoZWlnaHQsXG4gICAgKVxuICB9XG5cbiAgY2xvc2VGcmFtZShmcmFtZVB0cjogbnVtYmVyKSB7XG4gICAgdGhpcy5saWJhdkgyNjRNb2R1bGUuX2Nsb3NlX2ZyYW1lKGZyYW1lUHRyKVxuICB9XG59XG4iXX0=